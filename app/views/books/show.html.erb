<div class='container px-5 px-sm-0'>
  <div class='row'>
    <div class='col-md-3'>
      
      <h2>User info</h2>
      <%= render 'users/info', user: @user %>
      
      <h2 class="mt-3">New book</h2>
      <%= render 'users/form', users: @users, book: Book.new %>
    </div>
    
    <div class='col-md-8 offset-md-1'>
      
      
      
      <h2>Book detail</h2>

       <table class="table">
         
         

     <tbody>
       <tr>
         <td>
           <%= image_tag @user.get_profile_image(80,80) %>
           <br><%= link_to @user.name, "/users/#{@user.id}" %></br>
         </td>

         <td>
           <%= link_to @book.title, "/books/#{@book.id}" %>
         </td>

         <td>
           <%= @book.body %>
         </td>
         <!--いいね機能の追加-->
         <td>
           <% if @book.favorited_by?(current_user) %>
            <p>
                <%= link_to book_favorite_path(@book), method: :delete, style:'color:red;' do %>
                ♥<%= @book.favorites.count %>
                <% end %>
            </p>
            <% else %>
            <p>
                <%= link_to book_favorite_path(@book), method: :post do %>
                ♥<%= @book.favorites.count %>
                <% end %>
            </p>
            <% end %>
         </td>
         <!--コメント機能の追加-->
         <td>
           コメント数:<%= @book.book_comments.count %>
         </td>
    
         <td>
           <% if @book.user == current_user %>
             <%= link_to "Edit", edit_book_path(@book.id),class:"btn btn-success" %>
           <% end %>
         </td>

         <td>
           <% if @book.user == current_user %>
            <%= link_to "Destroy", book_path(@book.id), method: :delete, data: { confirm: "本当に消しますか？" }, class: "btn btn-danger" %>
           <% end %>
         </td>

       </tr>
      </tbody>
    </table>
              <!--コメント機能の追加-->
       <div>
           <% @book.book_comments.each do |comment| %>
            <% if comment.user.present? %>
             <%= image_tag comment.user.get_profile_image(50, 50) %>
             <%= comment.comment %>
             <% if current_user == comment.user %>
             <!--コメント用のdestroyの追加-->
             <%= link_to "Destroy",book_book_comment_path(comment), method: :delete, data: { confirm: "本当に消しますか？" }, class: "btn btn-danger" %>
             <% end %>
             <br><%= link_to comment.user.name, user_path(comment.user) %>
             
            <% end %>
           <% end %>
       </div>    
         
       <div>
        <%= form_with model: @comment, url: book_book_comments_path(@book) do |f| %>
           <%= f.text_area :comment, rows: '5', cols: '80', placeholder: "コメントをここに" %>
           <br><%= f.submit "送信" %>
        <% end %>
       </div>
    
  </div>
 </div>
</div>